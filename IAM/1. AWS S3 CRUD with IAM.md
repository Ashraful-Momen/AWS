খুব ভালো — আপনার দেওয়া নোট ধরে **ইংরেজি কমান্ড + বাংলা ব্যাখ্যা** মিলিয়ে সম্পূর্ণ, সরাসরি ব্যবহারযোগ্য স্টেপ-বাই-স্টেপ গাইড দিলাম। আপনি চাইলে এগুলো কপি-পেস্ট করে CLI/Console-এ চালাতে পারবেন। প্রতিটা কমান্ড/JSON-এ যেখানে আপনার মান লাগবে (ACCOUNT_ID, REGION, BUCKET_NAME ইত্যাদি) আমি সেটা স্পষ্টভাবে চিহ্নিত করেছি — অনুগ্রহ করে প্রতিটি প্লেসহোল্ডার পরিবর্তন করে নিন।

# ১) সংক্ষিপ্ত ওভারভিউ (What we'll do)

1. S3 bucket বানাবো (`myapp-prod-assets`)
2. একটি IAM User বানাবো (`dev-user`) — programmatic access (access key) জন্য
3. একটি Role বানাবো (`ec2-s3-access-role`) — EC2 instance-এ attach করার জন্য (trust: ec2.amazonaws.com)
4. একটি Custom policy বানাবো যা নির্দিষ্ট bucket-এ **S3 CRUD** (List/Get/Put/Delete) দেয় (`MyApp-S3-BucketAccess`)
5. Policy-টা User ও Role-এ attach করে টেস্ট করবো (local PC থেকে user দিয়ে, EC2 থেকে role দিয়ে)
6. S3 CRUD CLI উদাহরণ দেখানো হবে

# ২) আপনার নোট অনুযায়ী শুরু (আপনার দেওয়া স্টেপগুলোর সঙ্গে মিল রেখে)

আপনি ইতিমধ্যে লিখেছেন:

1. login your aws account => user name/password
2. IAM → quick_link → Access keys → create access key
3. local pc → `aws configure` ...

এখন আমি এগুলোকে extend করে, পরবর্তী ধাপগুলো add করলাম ও CLI-নির্দেশ দিলাম।

---

# ৩) ধাপ-বাইট-ধাপ (Bangla + commands)

## Step A — S3 bucket তৈরি করুন (Console বা CLI)

**CLI** (আপনার REGION এবং BUCKET_NAME বদলে দিন):

```bash
# উদাহরণ variables
AWS_REGION="us-east-1"
BUCKET="myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>"

# সৃজন
aws s3api create-bucket --bucket $BUCKET --region $AWS_REGION \
  --create-bucket-configuration LocationConstraint=$AWS_REGION
```

> নোট: `us-east-1` হলে `--create-bucket-configuration` ছাড়াও কাজ করে; সহজতার জন্য উপরের রিজিয়ন সেট করুন।

## Step B — IAM User তৈরি (programmatic access)

User নাম ও policy পরে attach করব। প্রথমে user তৈরি ও access key তৈরি:

```bash
# Create user
aws iam create-user --user-name dev-user

# Create access key for dev-user (store these safely)
aws iam create-access-key --user-name dev-user
```

> আউটপুটে `AccessKeyId` এবং `SecretAccessKey` আসবে — এগুলো আপনার local `aws configure` এ দেবেন বা নিরাপদ স্থানে রাখবেন।

**Local configure**:

```bash
aws configure
# AWS Access Key ID [None]: <AccessKeyId from above>
# AWS Secret Access Key [None]: <SecretAccessKey from above>
# Default region name [None]: us-east-1
# Default output format [None]: json
```

## Step C — Custom S3 policy (least-privilege) তৈরি করুন

**Policy JSON** (আপনার BUCKET নাম দিয়ে বদলাবেন). এটা S3-এ object-level CRUD এবং bucket list করার অনুমতি দেবে:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowListBucket",
      "Effect": "Allow",
      "Action": ["s3:ListBucket"],
      "Resource": ["arn:aws:s3:::myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>"]
    },
    {
      "Sid": "AllowObjectCRUD",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:GetObjectAcl",
        "s3:PutObjectAcl"
      ],
      "Resource": ["arn:aws:s3:::myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/*"]
    }
  ]
}
```

**Create managed policy (CLI)**:

1. Save JSON to `s3-policy.json` (উপরের কন্টেন্ট)
2. CLI দিয়ে policy তৈরি করুন:

```bash
aws iam create-policy --policy-name MyApp-S3-BucketAccess \
  --policy-document file://s3-policy.json
```

> আউটপুটে `Policy.Arn` দেখুন — পরে ব্যবহার করতে হবে (উদাহরণ: `arn:aws:iam::123456789012:policy/MyApp-S3-BucketAccess`)

## Step D — Policy attach to User

```bash
# ধরে নেই হুবহু policy ARN নিচে:
POLICY_ARN="arn:aws:iam::ACCOUNT_ID:policy/MyApp-S3-BucketAccess"

# attach to dev-user
aws iam attach-user-policy --user-name dev-user --policy-arn $POLICY_ARN
```

## Step E — Role তৈরি (EC2-এ ব্যবহার করার জন্য) + trust policy

Role-টা EC2 instance profile হিসেবে ব্যবহার করা হবে, যাতে instance থেকে S3 access করা যায়—Access Key ছাড়াই। প্রথমে trust policy ফাইল তৈরি করুন `trust-ec2.json`:

```json
{
  "Version":"2012-10-17",
  "Statement":[
    {
      "Effect":"Allow",
      "Principal":{"Service":"ec2.amazonaws.com"},
      "Action":"sts:AssumeRole"
    }
  ]
}
```

তারপর CLI-তে role তৈরি:

```bash
aws iam create-role --role-name ec2-s3-access-role --assume-role-policy-document file://trust-ec2.json
```

## Step F — Role-এ policy attach করুন

```bash
aws iam attach-role-policy --role-name ec2-s3-access-role --policy-arn $POLICY_ARN
```

## Step G — EC2 instance-এ Role attach (Instance Profile)

**নতুন ইনস্ট্যান্স Launch করার ক্ষেত্রে**: Launch ওয়িজার্ডে IAM role হিসেবে `ec2-s3-access-role` সিলেক্ট করুন।
**আগেই থাকা ইন্সট্যান্সে attach করতে চাইলে** (CLI):

```bash
# create instance profile and add role (প্রয়োজন হলে)
aws iam create-instance-profile --instance-profile-name ec2-s3-access-role-profile
aws iam add-role-to-instance-profile --instance-profile-name ec2-s3-access-role-profile --role-name ec2-s3-access-role

# এখন EC2-এ attach করব (ইন্সট্যান্স আইডি দিন)
INSTANCE_ID="i-0123456789abcdef0"
aws ec2 associate-iam-instance-profile --instance-id $INSTANCE_ID --iam-instance-profile Name=ec2-s3-access-role-profile
```

> নোট: কিছু ক্ষেত্রে `associate-iam-instance-profile` কাজ করার আগে instance profile fully created হতে কয়েক সেকেন্ড লাগতে পারে। Console এ UI দিয়ে attach করাটাও সহজ।

---

# ৪) S3 CRUD উদাহরণ (CLI ব্যবহার করে) — User (dev-user) থেকে টেস্ট

Local PC-এ `aws configure` দিয়ে dev-user credentials set করা আছে ধরে নিচ্ছি।

### 1. Bucket List (বা local থেকে সব bucket দেখুন)

```bash
aws s3 ls
```

### 2. Bucket তৈরি (যদি আগেই না থাকে)

```bash
aws s3 mb s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX> --region us-east-1
```

### 3. Upload (PutObject)

```bash
# একটি ফাইল আপলোড
aws s3 cp ./hello.txt s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/hello.txt
```

### 4. List objects in bucket

```bash
aws s3 ls s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/
```

### 5. Download (GetObject)

```bash
aws s3 cp s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/hello.txt ./hello-from-s3.txt
```

### 6. Delete object

```bash
aws s3 rm s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/hello.txt
```

### 7. Delete bucket (bucket must be empty)

```bash
aws s3 rb s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX> --force
# অথবা প্রথমে empty করে পরে rb without --force
```

---

# ৫) EC2 থেকে Role দিয়ে S3 CRUD টেস্ট (Instance profile ব্যবহার করে)

EC2-তে login করে (ssh), তারপর CLI commands একইভাবে চালান — কিন্তু এখানে AWS credentials থাকা লাগবে না, role থেকে temporary credentials auto-provide হবে।

```bash
# EC2 তে পরীক্ষা
aws sts get-caller-identity
# আউটপুট দেখাবে ARN: arn:aws:sts::ACCOUNT_ID:assumed-role/ec2-s3-access-role/...

# S3 list
aws s3 ls s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/

# Upload
echo "hi from ec2" > /tmp/ec2.txt
aws s3 cp /tmp/ec2.txt s3://myapp-prod-assets-<YOUR-UNIQUE-SUFFIX>/ec2.txt
```

> যদি access denied আসে: প্রথমে `aws sts get-caller-identity` চালিয়ে দেখুন আপনি কোন identity থেকে কাজ করছেন; তারপর IAM policy এর `Resource` বা bucket নাম সঠিক আছে কিনা চেক করুন।

---

# ৬) Troubleshooting টিপস (Common issues)

1. **AccessDenied** — policy-এর `Resource` সঠিকভাবে BUCKET নাম/আর্নে আছে কিনা চেক করুন। object-level ops-এ `arn:aws:s3:::bucket/*` লাগবে; bucket list-এ `arn:aws:s3:::bucket` লাগবে।
2. **Credentials conflict (local + role)** — local machine এ আজকের credentials থাকলে EC2 role নাও নিতে পারে; EC2 তে যদি `~/.aws/credentials` থেকে override হয়, environment variables আছে কিনা দেখুন। Instance profile ব্যবহার করলে local credentials ফাইল থাকা লাগবে না।
3. **Region mismatch** — bucket অন্য region-এ হলে `aws s3 cp` এ region mismatch হতে পারে — `--region` ব্যবহার করুন বা default region configure করুন।
4. **Instance profile not attached** — `aws sts get-caller-identity` দেখলে যদি user ARN আসে (role না) মানে instance profile attach হয়নি।

---

# ৭) নিরাপত্তা ও বেস্ট প্র্যাকটিস (সংক্ষিপ্ত)

* **Least privilege** — policy-তে শুধু প্রয়োজনীয় actions ও resource রাখুন।
* **Avoid long-lived keys** — EC2/Lambda/CodeBuild ইত্যাদি রিলে role ব্যবহার করুন।
* **Rotate access keys** — user keys সময়ে সময়ে rotate করুন।
* **MFA** — কনসোল user-দের জন্য enable করুন।
* **Use S3 bucket policy or KMS** — প্রয়োজনে bucket-level public access block ও encryption (SSE) চালু করুন।

---

# ৮) সম্পূর্ণ কাজটি স্বল্প রেফারেন্স (copy-paste-ready)

নীচে দ্রুত রেফারেন্স — মূল কমান্ড গুলো এক জায়গায়:

1. Create bucket

```bash
aws s3api create-bucket --bucket myapp-prod-assets-<SUFFIX> --region us-east-1 --create-bucket-configuration LocationConstraint=us-east-1
```

2. Create IAM user + access key

```bash
aws iam create-user --user-name dev-user
aws iam create-access-key --user-name dev-user   # save the keys
```

3. Create policy (save s3-policy.json)

```bash
aws iam create-policy --policy-name MyApp-S3-BucketAccess --policy-document file://s3-policy.json
```

4. Attach policy to user

```bash
aws iam attach-user-policy --user-name dev-user --policy-arn arn:aws:iam::ACCOUNT_ID:policy/MyApp-S3-BucketAccess
```

5. Create EC2 role (trust file `trust-ec2.json`)

```bash
aws iam create-role --role-name ec2-s3-access-role --assume-role-policy-document file://trust-ec2.json
aws iam attach-role-policy --role-name ec2-s3-access-role --policy-arn arn:aws:iam::ACCOUNT_ID:policy/MyApp-S3-BucketAccess
aws iam create-instance-profile --instance-profile-name ec2-s3-access-role-profile
aws iam add-role-to-instance-profile --instance-profile-name ec2-s3-access-role-profile --role-name ec2-s3-access-role
aws ec2 associate-iam-instance-profile --instance-id i-0123456789abcdef0 --iam-instance-profile Name=ec2-s3-access-role-profile
```

6. S3 CRUD commands (user বা role থেকে একইভাবে চালান)

```bash
aws s3 cp ./hello.txt s3://myapp-prod-assets-<SUFFIX>/hello.txt
aws s3 ls s3://myapp-prod-assets-<SUFFIX>/
aws s3 cp s3://myapp-prod-assets-<SUFFIX>/hello.txt ./down.txt
aws s3 rm s3://myapp-prod-assets-<SUFFIX>/hello.txt
aws s3 rb s3://myapp-prod-assets-<SUFFIX> --force
```

---

# ৯) শেষ কথা — আপনি কি চান আমি এখনই?

আপনি যদি চান আমি:

* (A) উপরোক্ত সব JSON-এ আপনার `ACCOUNT_ID`, `REGION`, `BUCKET_NAME` বসিয়ে **final ready JSON** তৈরি করে দিই, অথবা
* (B) Console-এ step-by-step screenshot-এবল/GUI নির্দেশ লিখে দিই, অথবা
* (C) GitHub/Gist-এ রাখার মতো একটি ছোট bash script (that creates policy, role, user) লিখে দিই — আপনি কোনটা চান?

আপনি যা-ই বলুন, আমি সরাসরি আপনার মানগুলো (ACCOUNT_ID, BUCKET_NAME, REGION) ব্যবহার করে সেই টেক্সট/স্নিপেট তৈরি করে দেব।
