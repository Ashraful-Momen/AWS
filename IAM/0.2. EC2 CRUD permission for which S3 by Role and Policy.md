
---

# ЁЯзн Step-by-Step: AWS S3 CRUD with IAM Role & Policy

---

## ЁЯкЬ **Step 1: S3 Bucket рждрзИрж░рж┐ ржХрж░рзЛ**

```bash
aws s3 mb s3://my-demo-s3-bucket-2025
```

ЁЯСЙ ржПржЦрж╛ржирзЗ `my-demo-s3-bucket-2025` ржирж╛ржо unique рж╣рждрзЗ рж╣ржмрзЗ (S3 global namespace)ред

**Check:**

```bash
aws s3 ls
```

---

## ЁЯкЬ **Step 2: IAM Role рждрзИрж░рж┐ ржХрж░рзЛ (for EC2)**

ржПржЗ role EC2 instance ржПрж░ рж╕рж╛ржерзЗ attach рж╣ржмрзЗ ржпрж╛рждрзЗ EC2 тЖТ S3 рждрзЗ CRUD ржХрж░рждрзЗ ржкрж╛рж░рзЗред

```bash
aws iam create-role \
  --role-name EC2S3AccessRole \
  --assume-role-policy-document file://trust-policy.json
```

---

### ЁЯФ╣ trust-policy.json (role ржХрзЗ ржмрж▓рзЗ ржХрзЗ рждрж╛ржХрзЗ use ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "ec2.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

ЁЯСЙ ржорж╛ржирзЗ: тАЬEC2 рж╕рж╛рж░рзНржнрж┐рж╕ ржПржЗ role ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗтАЭ

---

## ЁЯкЬ **Step 3: Policy attach ржХрж░рзЛ role ржПрж░ рж╕рж╛ржерзЗ**

AWS already predefined policy ржжрзЗрзЯ (Managed Policy)
тЖТ ржЖржорж░рж╛ ржПржЦрж╛ржирзЗ `AmazonS3FullAccess` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм

```bash
aws iam attach-role-policy \
  --role-name EC2S3AccessRole \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess
```

тЬЕ ржПржЦржи EC2 instance ржпржжрж┐ ржПржЗ role ржкрж╛рзЯ, рждрж╛рж╣рж▓рзЗ full S3 access ржкрж╛ржмрзЗред

---

## ЁЯкЬ **Step 4: Role ржЯрж┐ EC2 Instance-ржП attach ржХрж░рзЛ**

рждрзБржорж┐ existing EC2 instance ржП attach ржХрж░рждрзЗ ржкрж╛рж░рзЛ ЁЯСЗ

```bash
aws ec2 associate-iam-instance-profile \
  --instance-id i-0123456789abcdef0 \
  --iam-instance-profile Name=EC2S3AccessRole
```

ржЕржержмрж╛ ржирждрзБржи EC2 launch ржХрж░рж╛рж░ рж╕ржорзЯ:

* Console тЖТ EC2 тЖТ Launch instance тЖТ тАЬIAM RoleтАЭ dropdown тЖТ `EC2S3AccessRole`

---

## ЁЯкЬ **Step 5: EC2 ржерзЗржХрзЗ S3 CRUD Command**

ржПржЦржи рждрзЛржорж╛рж░ EC2 instance-ржПрж░ ржнрж┐рждрж░ ржврзБржХрзЗ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржУ ЁЯСЗ

```bash
# тЬЕ List Buckets
aws s3 ls

# тЬЕ Upload File
aws s3 cp myfile.txt s3://my-demo-s3-bucket-2025/

# тЬЕ List Bucket Contents
aws s3 ls s3://my-demo-s3-bucket-2025/

# тЬЕ Download File
aws s3 cp s3://my-demo-s3-bucket-2025/myfile.txt ./myfile.txt

# тЬЕ Delete File
aws s3 rm s3://my-demo-s3-bucket-2025/myfile.txt
```

рж╕ржм ржХрж╛ржЬ ржПржЦржи рж╣ржмрзЗ тАФ Access key ржЫрж╛рзЬрж╛ржЗ ЁЯШО
ржХрж╛рж░ржг EC2 instance ржирж┐ржЬрзЗржЗ temporary credential ржкрж╛рзЯ IAM Role ржерзЗржХрзЗред

---

## ЁЯзй **Diagram: Full Flow**

```
+------------------------+
|   IAM Policy           |
|   (AmazonS3FullAccess) |
+----------^-------------+
           |
+----------+-------------+
|   IAM Role: EC2S3AccessRole  |
|   (Trusted Entity: EC2)      |
+----------^-------------+
           |
+----------+-------------+
|   EC2 Instance          |
|   (uses temporary creds)|
+----------^-------------+
           |
           v
+------------------------+
|        S3 Bucket       |
|  (CRUD Operations)     |
+------------------------+
```

---

## ЁЯза **Shortcut ржоржирзЗ рж░рж╛ржЦрж╛рж░ ржЯрзНрж░рж┐ржХ**

```
S3 CRUD via Role тЖТ 4 Step Formula:
----------------------------------
1я╕ПтГг Create Role тЖТ Trust Policy (EC2)
2я╕ПтГг Attach S3 Policy тЖТ (AmazonS3FullAccess)
3я╕ПтГг Attach Role тЖТ EC2
4я╕ПтГг Run aws s3 ls / cp / rm (inside EC2)
```

---

## ЁЯз╛ **Bonus: Custom Minimal S3 Policy (only CRUD for one bucket)**

ржпржжрж┐ full ржирж╛ ржЪрж╛ржУ, рж╢рзБржзрзБ ржПржХржЯрж┐ржорж╛рждрзНрж░ bucket-ржПрж░ CRUD ржжрж╛ржУ ЁЯСЗ

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": "arn:aws:s3:::my-demo-s3-bucket-2025"
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::my-demo-s3-bucket-2025/*"
    }
  ]
}
```

ржПржЯрж╛ save ржХрж░рзЗ attach ржХрж░рзЛ:

```bash
aws iam put-role-policy \
  --role-name EC2S3AccessRole \
  --policy-name S3CRUDCustomPolicy \
  --policy-document file://s3-crud-policy.json
```

---

